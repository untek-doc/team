Архитектура
========

> Хорошая архитектура - это дорого. 
> Плохая архитектура - еще дороже.
> 
> *Александр Макаров*

Чтобы уложить в мозг работу системы, необходимо разделить систему на доменные сущности и слои.

## Термины (проблемно-ориентированное проектирование)

* Домен - сущности и действия реального мира, которые нужно моделировать
* Единый язык домена - набор терминов, применяемых в модели домена для объяснения связей и действий
* Домен (Domain) —  предментая область
* Модель (Model) — это ваше решение
* Доменная модель (Domain Model) – это организованное и структурированное знание проблемы. 
Domain Model должен представлять собой словарный запас и ключевые понятия предметной области, 
и он должен определить отношения между всеми субъектами в рамках домена. 
Domain Model является основой языка, используемого всеми членами команды

## Что такое архитектура?

* Это ряд решений о том, как взаимодействуют отдельные части системы.
* Архитектура описывает интерфейсы, контракты и абстракцию.

## Цели

* борьба со сложностью
* сделать понятным каждый уровень абстракции

Борьба со сложностью достигается разбиением кода на отдельные элементы и описанием их интерфейсов.
Код становится легче использовать тестировать.

## Правила

* низший слой не знает о высшем
* служащие одной цели классы обединяются в пакеты (логические рамки)
* доменный слой не зависит ни от чего

## Что описывать

* Набор терминов (Единый язык домена)
* Набор компонентов
* структура компонентов
* взаимодействие компонентов
* размещение

## Слои

В проекте используется архитектура MVC.
 
* M - модель
* V - вид
* C - контроллер

### Модель

Модель - это не Active Record в чистом виде, а совокупность слоев, обеспечивающая работу бизнес-модели.

Модель имеет слои:

* Домен
* Сервис
* Сущность
* Хранилище

Интерфейс модели знает контроллер.

Модель не знает о контроллерах и представлениях.

### Контроллер

Контроллер 

* принимает параметры параметры запроса
* взаимодействует сервисами
* взимодействует с представлением

АПИ контроллер имеет те же пункты, кроме представления. 
Представление заменяется сериализатором данных (JSON, XML).

## Общая схема

![схема](img/common-scheme.png)

Между слоями передается либо сущность, либо коллекция сущностей, либо DTO.

## Жирная модель или жирный контроллер?

Логику держим в сервисах, вызываем методы сервисов из контроллеров. 
Суть в том, что мы можем вызывать один и тот же бизнесс-процесс из разных мест.

Если есть жирная модель или контроллер, то разносим логику по слоям.

Если говорить об `active record` моделях, то они занимают инфраструктурный слой, используются как удобная прослойка для работы с БД.
Так же, этим может заниматься `query builder`.
